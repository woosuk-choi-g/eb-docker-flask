name: deploy to eb
on: 
  workflow_dispatch:
    inputs:
      ECR_REPOSITORY:
        description: ECR 레포지토리
        type: choice
        options:
          - eb-docker-flask
        required: false
      IMAGE_TAG:
        description: 도커 이미지 태그
        type: string
        required: true
jobs:
  build-and-push:
    runs-on: ubuntu-latest
    steps:
      - 
        name: 체크아웃
        uses: action/checkout@v3
      - 
        name: ECR 로그인
        id: login-ecr
        uses: aws-actions/amazon-ecr-login@v1
      - 
        name: 도커 이미지 빌드하고 푸시
        uses: docker/build-push-action@v3
        with:
          context: .
          push: true
          tags: ${{ steps.login-ecr.outputs.registry }}/${{ inputs.ECR_REPOSITORY }}:${{ inputs.IMAGE_TAG }}
          cache-from: type=registry,ref=${{ steps.login-ecr.outputs.registry }}/${{ inputs.ECR_REPOSITORY }}:buildcache
          cache-to: type=registry,ref=${{ steps.login-ecr.outputs.registry }}/${{ inputs.ECR_REPOSITORY }}:buildcache,mode=max
  # eb-deploy:
  #   runs-on: ubuntu-latest
  #   needs: build-and-push
  #   if: ${{ needs.success() }}
      # eb deploy package 빌드
      # eb 배포